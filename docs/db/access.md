
# Таблицы и поля, реализующие права доступа и аудит

## Таблица USER_GROUP

Хранит информацию о группах пользователей

| Имя поля    | Описание |
|-------------|----------|
| GROUP_ID | Идентификатор группы. Генерируется автоматически. |
| GROUP_NAME | Имя группы |
| DESCRIPTION | Описание |
| CREATED | Дата создания группы пользователей. Генерируется автоматически |
| MODIFIED | Дата последнего изменения группы пользователей. Генерируется и изменяется автоматически |
| LAST_MODIFIED_BY | ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего группу пользователей |
| shared_content_items | Флаг, указывающий на то, что для группы включено совместное владение создаваемыми статьями |
| nt_group | Текстовое поле, хранящее привязку к группе ActiveDirectory |
| ad_sid | Не используется (сохранено для обратной совместимости cQP7) |
| BUILT_IN | Группа является встроенной |
| READONLY | Группа только для чтения (ее нельзя отредактировать или удалить) |
| use_parallel_workflow | Флаг, указывающий на то, что для группы включен параллельный Worfklow |
| CAN_UNLOCK_ITEMS | Члены группы могут разблокировать статьи других пользователей, не будучи администраторами |
| CAN_MANAGE_SCHEDULED_TASKS | Члены группы могут управлять задачами, выполняемыми по расписанию, не будучи администраторами |

## Таблица GROUP_TO_GROUP

Хранит информацию о дереве групп

| Имя поля    | Описание |
|-------------|----------|
| Child_Group_Id | Идентификатор дочерней группы ([Таблица USER_GROUP](#таблица-user_group)) |
| Parent_Group_Id | Идентификатор родительской группы ([Таблица USER_GROUP](#таблица-user_group)) |

## Таблица USER_GROUP_BIND

Хранит информацию о привязке пользователей к группам

| Имя поля    | Описание |
|-------------|----------|
| GROUP_ID | Идентификатор группы ([Таблица USER_GROUP](#таблица-user_group)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |

## Таблица PERMISSION_LEVEL

Справочная таблица, хранящая информацию о возможных уровнях доступа в системе

| Имя поля    | Описание |
|-------------|----------|
| PERMISSION_LEVEL | Число, определяющее уровень доступа |
| PERMISSION_LEVEL_ID | Идентификатор уровня доступа |
| PERMISSION_LEVEL_NAME | Имяуровнядоступа |
| DESCRIPTION | Описание |

## Таблица SITE_ACCESS

Хранит правила доступа к сайту

| Имя поля    | Описание |
|-------------|----------|
| SITE_ID | ID родительского сайта ([Таблица SITE](main.md#таблица-site)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| GROUP_ID | Идентификатор группы ([Таблица USER_GROUP](#таблица-user_group)) |
| PERMISSION_LEVEL_ID | Идентификатор уровня доступа ([Таблица PERMISSION_LEVEL](#таблица-permission_level)) |
| CREATED | Дата создания правила доступа. Генерируется автоматически |
| MODIFIED | Дата последнего изменения правила доступа. Генерируется и изменяется автоматически |
| LAST_MODIFIED_BY | ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего правило доступа |
| propagate_to_contents | Флаг, указывающий на то, копировать ли правило в создаваемые дочерние контенты |
| SITE_ACCESS_ID | Идентификатор правила. Генерируется автоматически |

## Таблица ACTION_ACCESS

Хранит правила доступа к действиям

| Имя поля    | Описание |
|-------------|----------|
| ACTION_ACCESS_ID | Идентификатор правила. Генерируется автоматически |
| ACTION_ID | Идентификатор действия, для которого создается правило доступа ([Таблица BACKEND_ACTION](structure.md#таблица-backend_action)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| GROUP_ID | Идентификатор группы ([Таблица USER_GROUP](#таблица-user_group)) |
| PERMISSION_LEVEL_ID | Идентификатор уровня доступа ([Таблица PERMISSION_LEVEL](#таблица-permission_level)) |
| CREATED | Дата создания правила доступа. Генерируется автоматически |
| MODIFIED | Дата последнего изменения правила доступа. Генерируется и изменяется автоматически |
| LAST_MODIFIED_BY | ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего правило доступа |

## Таблица CONTENT_ACCESS

Хранит правила доступа к контентам

| Имя поля    | Описание |
|-------------|----------|
| CONTENT_ID | Идентификатор контента, для которого создается правило доступа ([Таблица CONTENT](main.md#таблица-content)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| GROUP_ID | Идентификатор группы ([Таблица USER_GROUP](#таблица-user_group)) |
| PERMISSION_LEVEL_ID | Идентификатор уровня доступа ([Таблица PERMISSION_LEVEL](#таблица-permission_level)) |
| CREATED | Дата создания правила доступа. Генерируется автоматически |
| MODIFIED | Дата последнего изменения правила доступа. Генерируется и изменяется автоматически |
| LAST_MODIFIED_BY | ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего правило доступа |
| propagate_to_items | Флаг, указывающий на то, копировать ли правило в создаваемые дочерние статьи |
| HIDE | Зарезеривировано |
| CONTENT_ACCESS_ID | Идентификатор правила. Генерируется автоматически |

## Таблица CONTENT_ITEM_ACCESS

Хранит правила доступа к статьям (они используется только если включены на уровне контента полем allow_items_permission)

| Имя поля    | Описание |
|-------------|----------|
| CONTENT_ITEM_ID | Идентификатор статьи, для которой создается правило доступа ([Таблица CONTENT_ITEM](main.md#таблица-content_item)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| GROUP_ID | Идентификатор группы ([Таблица USER_GROUP](#таблица-user_group)) |
| PERMISSION_LEVEL_ID | Идентификатор уровня доступа ([Таблица PERMISSION_LEVEL](#таблица-permission_level)) |
| CREATED | Дата создания правила доступа. Генерируется автоматически |
| MODIFIED | Дата последнего изменения правила доступа. Генерируется и изменяется автоматически |
| LAST_MODIFIED_BY | ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего правило доступа |
| CONTENT_ITEM_ACCESS_ID | Идентификатор правила. Генерируется автоматически |

### Триггеры таблицы CONTENT_ITEM_ACCESS

| Имя поля    | Описание |
|-------------|----------|
| ti_content_item_access_log_history | Сохраняет информацию об изменения прав доступа в лог CONTENT_ITEM_STATUS_HISTORY |
| tu_content_item_access_log_history | Сохраняет информацию об изменения прав доступа в лог CONTENT_ITEM_STATUS_HISTORY |

## Таблица CONTENT_FOLDER_ACCESS

Хранит правила доступа к папкам контента. В настоящее время эти права не применяются

| Имя поля    | Описание |
|-------------|----------|
| content_FOLDER_ID | Идентификатор папки контента, для которой создается правило доступа ([Таблица CONTENT_FOLDER](extra.md#таблица-content_folder)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| GROUP_ID | Идентификатор группы ([Таблица USER_GROUP](#таблица-user_group)) |
| PERMISSION_LEVEL_ID | Идентификатор уровня доступа ([Таблица PERMISSION_LEVEL](#таблица-permission_level)) |
| CREATED | Дата создания правила доступа. Генерируется автоматически |
| MODIFIED | Дата последнего изменения правила доступа. Генерируется и изменяется автоматически |
| LAST_MODIFIED_BY | ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего правило доступа |
| CONTENT_FOLDER_ACCESS_ID | Идентификатор правила. Генерируется автоматически |

## Таблица FOLDER_ACCESS

Хранит правила доступа к папкам сайта

| Имя поля    | Описание |
|-------------|----------|
| FOLDER_ID | Идентификатор папки сайта, для которой создается правило доступа ([Таблица FOLDER](extra.md#таблица-folder)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| GROUP_ID | Идентификатор группы ([Таблица USER_GROUP](#таблица-user_group)) |
| PERMISSION_LEVEL_ID | Идентификатор уровня доступа ([Таблица PERMISSION_LEVEL](#таблица-permission_level)) |
| CREATED | Дата создания правила доступа. Генерируется автоматически |
| MODIFIED | Дата последнего изменения правила доступа. Генерируется и изменяется автоматически |
| LAST_MODIFIED_BY | ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего правило доступа |
| FOLDER_ACCESS_ID | Идентификатор правила. Генерируется автоматически |

## Таблица WORKFLOW_ACCESS

Хранит правила доступа к Workflow

| Имя поля    | Описание |
|-------------|----------|
| WORKFLOW_ID | Идентификатор Workflow, для которого создается правило доступа ([Таблица WORKFLOW](extra.md#таблица-workflow)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| GROUP_ID | Идентификатор группы ([Таблица USER_GROUP](#таблица-user_group)) |
| PERMISSION_LEVEL_ID | Идентификатор уровня доступа ([Таблица PERMISSION_LEVEL](#таблица-permission_level)) |
| CREATED | Дата создания правила доступа. Генерируется автоматически |
| MODIFIED | Дата последнего изменения правила доступа. Генерируется и изменяется автоматически |
| LAST_MODIFIED_BY | ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего правило доступа |
| WORKFLOW_ACCESS_ACCESS_ID | Идентификатор правила. Генерируется автоматически |

## Таблица ENTITY_TYPE_ACCESS

Хранит правила доступа на типы сущностей (как на группы действий).

| Имя поля    | Описание |
|-------------|----------|
| ENTITY_TYPE_ACCESS_ID | Идентификатор правила. Генерируется автоматически |
| ENTITY_TYPE_ID | Идентификатор типа сущности, для которого создается правило доступа ([Таблица ENTITY_TYPE](structure.md#таблица-entity-type)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| GROUP_ID | Идентификатор группы ([Таблица USER_GROUP](#таблица-user_group)) |
| PERMISSION_LEVEL_ID | Идентификатор уровня доступа ([Таблица PERMISSION_LEVEL](#таблица-permission_level)) |
| CREATED | Дата создания правила доступа. Генерируется автоматически |
| MODIFIED | Дата последнего изменения правила доступа. Генерируется и изменяется автоматически |
| LAST_MODIFIED_BY | ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего правило доступа |

## Таблица TAB_ACCESS

Хранит правила доступа на вкладки. Не используется в QP8. Оставлено для обратной совместимости с QP7

| Имя поля    | Описание |
|-------------|----------|
| TAB_ID | Идентификатор вкладки, для которой создается правило доступа ([Таблица TABS](structure.md#таблица-tabs)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| GROUP_ID | Идентификатор группы ([Таблица USER_GROUP](#таблица-user_group)) |
| PERMISSION_LEVEL_ID | Идентификатор уровня доступа ([Таблица PERMISSION_LEVEL](#таблица-permission_level)) |

## Таблица USER_DEFAULT_FILTER

Настройки фильтров по умолчанию для пользователя

| Имя поля    | Описание |
|-------------|----------|
| USER_ID | ID пользователя ([Таблица USERS](#таблица-users)) |
| CONTENT_ID | ID контента, из которого берется фильтр ([Таблица CONTENT](main.md#таблица-content)) |
| CONTENT_ITEM_ID | ID статьи для фильтрации ([Таблица CONTENT_ITEM](main.md#таблица-content_item)) |

## Таблица USER_TO_PANEL

Настройки панелей на странице Home для пользователя в QP7. Не используется в QP8.

| Имя поля    | Описание |
|-------------|----------|
| user_id | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| panel_id | Идентификатор панели ([Таблица TODAY_PANELS](structure.md#таблица-today_panels) |
| panel_block_no | Номерколонки |
| panel_order | Порядок в колонке |
| panel_height | Высота |
| save_block_no | Номер колонки при предыдущем сохранении |
| save_order | Порядок в колонке при предыдущем сохранении |

## Таблица SYSTEM_STATUS_TYPE

Справочник системных типов для статей

| Имя поля    | Описание |
|-------------|----------|
| ID | Идентификатор системного статуса |
| NAME | Имя системного статуса |
| DESCRIPTION | Описание |
| DISABLE_CLEAR | Разрешено ли очищать события этого типа? |

## Таблица CONTENT_ITEM_STATUS_HISTORY

История изменений статусов для статей

| Имя поля    | Описание |
|-------------|----------|
| STATUS_HISTORY_ID | Уникальный идентификатор записи |
| STATUS_HISTORY_DATE | Дата возникновения события |
| CONTENT_ITEM_ID | Идентификатор статьи ([Таблица CONTENT_ITEM](main.md#таблица-content_item)) |
| STATUS_TYPE_ID | Идентификатор статуса ([Таблица STATUS_TYPE](extra.md#таблица-status_type)) |
| USER_ID | Идентификатор пользователя ([Таблица USERS](#таблица-users)) |
| DESCRIPTION | Описание |
| CREATED | Дата создания записи о событии |
| SYSTEM_STATUS_TYPE_ID | Идентификатор системного статуса ([Таблица SYSTEM_STATUS_TYPE](structure.md#таблица-system_status_type)) |
| content_item_version_id | Идентификатор версии статьи ([Таблица CONTENT_ITEM_VERSION](extra.md#таблица-content_item_version)) |
| ARCHIVE | Значение флага ARCHIVE статьи на момент события |
| VISIBLE | Значение флага VISIBLE статьи на момент события |

## Таблица REMOVED_FILES

Хранит информацию о файлах, удаленных в QP7.

| Имя поля    | Описание |
|-------------|----------|
| IS_FOLDER | Папка или файл |
| IS_RENAMED | Переименование или удаление |
| IS_MOVED | Перемещение или удаление |
| USER_ID | ID пользователя, выполнившего операцию ([Таблица USERS](#таблица-users)) |
| NAME | Имя файла (папки) до операции |
| PATH | Путь к файлy (папке) до операции |
| DESTINATION | Путь к файлy (папке) после операции (в случае перемещения) |
| DELETED | Дата выполнения операции |

## Таблица REMOVED_ENTITIES

Хранит информацию о cущностях, удаленных в QP7

| Имя поля    | Описание |
|-------------|----------|
| ENTITY_NAME | Имя типа сущности |
| ID | ID сущности |
| USER_ID | ID пользователя, выполнившего операцию ([Таблица USERS](#таблица-users)) |
| DELETED | Дата выполнения операции |
| PARENT_ID | ID родительской сущности |
| TITLE | Заголовок сущности |

## Таблица BACKEND_ACTION_LOG

Лог действий пользователя в QP8

| Имя поля    | Описание |
|-------------|----------|
| ID | Идентификатор записи |
| USER_ID | ID пользователя, выполнившего действие ([Таблица USERS](#таблица-users)) |
| EXEC_TIME | Дата и время выполнения действия |
| ACTION_CODE | Код действия |
| ACTION_TYPE_CODE | Код типа действия |
| ENTITY_TYPE_CODE | Код типа сущности |
| ENTITY_ID | ID сущности |
| ENTITY_STRING_ID | ID сущности (строковое представление) |
| PARENT_ENTITY_ID | ID родительской сущности |
| ENTITY_TITLE | Заголовок сущности |
| API | Изменение было внесено через API. В настоящее время не используется |
| USER_IP | IP адрес пользователя с которого пришел запрос на выполнение действия |

## Таблица BACKEND_ACTION_LOG_USER_GROUPS

Группы в которых находился пользователь в момент выполнения действия

| Имя поля    | Описание |
|-------------|----------|
| ID | Идентификатор записи |
| BACKEND_ACTION_LOG_ID | ID лога пользователя ([Таблица BACKEND_ACTION_LOG](#таблица-BACKEND_ACTION_LOG)) |
| GROUP_ID | ID группы пользователя ([Таблица USER_GROUP](#таблица-USER_GROUP)) |


## Таблица SESSIONS_LOG

Лог сессий пользователя в QP8

| Имя поля    | Описание |
|-------------|----------|
| SESSION_ID | ID сессии |
| LOGIN | Логин |
| PASSWORD | Пароль. В настоящее время не сохраняется |
| USER_ID | ID авторизованного пользователя ([Таблица USERS](#таблица-users)) |
| START_TIME | Время входа в систему |
| END_TIME | Время выхода из системы |
| IP | IP-адрес |
| BROWSER | Строка User-Agent |
| SERVER_NAME | Имя сервера |
| AUTO_LOGGED | Был выполнен вход через интеграцию с ActiveDirectory? |
| Sid | ID сессии на веб-сервере. Используется для аутентификации. Удаляется после первого использования |
| VISUAL_EDITOR_URL | Не используется |
| IS_QP7 | Сессия в QP7 или в QP8? |
| LAST_UPDATE | Дата и время последнего обращения в QP по сессии |

## Таблица DANGEROUS_ACTIONS

Лог потенциально опасных действия над сущностями QP7. Не используется в QP8

| Имя поля    | Описание |
|-------------|----------|
| ACTION_NAME | Имя действия |
| ENTITY_NAME | Имя сущности |
| ID | Идентификатор сущности |
| USER_ID | ID пользователя, выполнившего действие ([Таблица USERS](#таблица-users)) |
| PERFORMED | Дата и время выполнения действия |
| DESCRIPTION | Описание |

## Таблица USERS

Таблица хранит всех пользователей системы, которые могут залогиниться в текущую БД (текущий customer code)

| Имя поля    | Описание |
|-------------|----------|
| USER_ID | Уникальный числовой идентификатор, генерируется автоматически |
| PASSWORD | Пароль пользователя. В настоящее время в базе не хранится, а запись в это поле обрабатывается триггером. |
| DISABLED | Флаг, указывающий на то, что пользователь заблокирован (не может войти в систему) |
| FIRST_NAME | Имя пользователя |
| LAST_NAME | Фамилия пользователя |
| EMAIL | E-mail пользователя |
| AUTO_LOGIN | Флаг, разрешающий автоматический вход в систему без ввода логина и пароля при использовании WindowsAuthentication |
| NT_LOGIN | Имя пользователя в ActiveDirectory (включая домен). Используется для автоматического входа в систему. |
| LAST_LOGIN | Время, когда пользователь последний раз заходил в систему. |
| SUBSCRIBED | Не используется. Оставлено для обратной совместимости с QP7. |
| CREATED | Дата создания пользователя. Генерируется автоматически |
| MODIFIED | Дата последнего изменения профиля пользователя. Генерируется и изменяется автоматически |
| LAST_MODIFIED_BY | ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего профиль пользователя |
| LANGUAGE_ID | ID языка (втаблице LANGUAGES). Задает язык интерфейса пользователя в бэкенде |
| VMODE | Не используется (сохранено для обратной совместимости c QP7) |
| ad_sid | Не используется (сохранено для обратной совместимости c QP7) |
| allow_stage_edit_field | Настройки режима OnScreen в ASP. Устаревшее поле (сохранено для обратной совместимости c QP7) |
| allow_stage_edit_object | Настройки режима OnScreen в ASP. Устаревшее поле (сохранено для обратной совместимости с QP7) |
| BUILT_IN | Признак системного пользователя |
| LOGIN | Логин пользователя |
| Hash | Хэш пароля (MD5). Вычисляется триггером на основании информации, записываемой в поле PASSWORD |
| Salt | Соль для хэша пароля. Генерируется автоматически |
| PASSWORD_MODIFIED | Дата последней модификации пароля. Вычисляется триггером |
| ENABLE_CONTENT_GROUPING_IN_TREE | Флаг, включающий для пользователя группировку контентов в дереве бэкенда QP8 |
| MUST_CHANGE_PASSWORD | Флаг, указывающий на то, что пользователь должен сменить пароль при следующем логине в систему |

### Триггеры таблицы USERS

| Имя триггера | Описание |
|--------------|----------|
| ti_add_to_everyone_group | Вызывается при вставке нового пользователя. Добавляет его в группу Everyone. Отключён программно в новой версии QP8. |
| tiu_update_hash | Обновление хеша при установке пароля пользователя. Реализован для всех поддерживаемых типов БД. |
| tbd_user | Удаление дочерних записей для пользователя, которые не могут быть удалены каскадно. Не реализован в Postgres |

## Таблица ACCESS_TOKEN

Таблица дополнительной аутентификации по токену, которая для своей работы должна быть включена настройкой USE_TOKENS ([см. Таблица DB](structure.md#таблица-db))

| Имя поля       | Описание |
|----------------|----------|
| Id | ID токена |
| UserId | ID пользователя ([Таблица USERS](#таблица-users)) |
| Token | Токен |
| ExpirationDate | Дата устаревания токена |
| Application | Название приложения |
| SessionId | ID сессии |
