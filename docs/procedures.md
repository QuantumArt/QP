# Хранимые процедуры

| Имя процедуры  | Описание |
|----------------|----------|
| add_update_foreign_key | Служебная процедура, используется при создании фиксов БД |
| clear_content_versions | Не используется. Будет удалена в ближайшее время. |
| clear_object_format_versions | Очистка версий для заданного формата. Не используется в QP8. Временно оставлено для обратной совместимости с QP7. |
| create_content_item_version | Выполняет создание версии для заданной статьи. |
| pass_objs_ownership_to_admin | Не используется. Будет удалена в ближайшее время. |
| qp_add_column | Добавляет столбец в контентную таблицу |
| qp_add_contents_new_site | Клонирует структуру контентов (при клонировании сайта) |
| qp_add_index | Создает индекс для столбца контентной таблицы |
| qp_all_article_search | Поиск по всем статьям |
| qp_apply_default_text | Применение дефолтного значения для полей типа Textbox и VisualEditor |
| qp_apply_default_value | Применение дефолтного значения для простых полей, кроме Textbox и VisualEditor |
| qp_apply_link_id_to_data | Применение link_id для столбца M2M в контентной таблице |
| qp_approvalArticles | Статьи, ожидающие утверждения (не используется в QP8) |
| qp_articles | Заблокированные статьи (не используется в QP8) |
| qp_authenticate | Универсальная процедура аутентификации |
| qp_batch_delete_contents | Пакетное удаление контентов (используется при удалении сайта) |
| qp_build_link_view | Строит представления (Пользовательские представления вида LINK_NN, Пользовательские представления вида LINK_NN_UNITED) |
| qp_build_query_vcontent_view | Построение виртуального контента типа USERQUERY (не используется в QP8) |
| qp_build_union_vcontent_view | Построение виртуального контента типа UNION (не используется в QP8) |
| qp_check_entity_existence | Проверка сущности на существование |
| qp_check_target_table_async | Определение того, какая таблица является целевой для статьи ([Пользовательские таблицы вида CONTENT_NNN](main#пользовательские-таблицы-вида-content_nnn), [Пользовательские таблицы вида CONTENT_NNN_ASYNC](main#пользовательские-таблицы-вида-content_nnn_async) |
| qp_check_unique_data_in_set | Проверка уникальности для набора полей (список ID) |
| qp_clean_versions | Очистка дубликатов версий БД (фиксов) |
| qp_clear_relations | Очистка ссылок на статью (приудалении) |
| qp_clear_versions_for_field | Удаление данных версий для поля |
| qp_content_constraint_list | Список ограничений уникальности контента (не используется в QP8) |
| qp_content_frontend_views_create | Cоздание представлений (Пользовательские представления вида CONTENT_NNN_LIVE, Пользовательские представления вида CONTENT_NNN_STAGE) |
| qp_content_frontend_views_recreate | Обновление представлений (Пользовательские представления вида CONTENT_NNN_LIVE, Пользовательские представления вида CONTENT_NNN_STAGE) |
| qp_content_items_list | Получение списка статей (не используется в QP8) |
| qp_content_list | Получение списка контентов с учетом Security |
| qp_content_list_for_group | Получение списка контентов для группы с учетом Security |
| qp_content_table_create | Создание контентной таблицы |
| qp_content_table_drop | Удаление контентной таблицы |
| qp_content_table_fill | Заполнение контентной таблицы |
| qp_content_united_view_create | Создает представление CONTENT_NNN_UNITED для заданного контента |
| qp_content_united_view_recreate | Пересоздает представление CONTENT_NNN_UNITED для заданного контента |
| qp_content_version_view_create | Создает версионное представление для заданного контента. Неиспользуетсяв QP8 |
| qp_convert_tab_access_to_action_access | Процедура переноса прав доступа QP7 -\> QP8. Уже не используется |
| qp_copy_blob_data_to_data | Процедура переноса данных из столбца BLOB_DATA в столбец DATA для поля контента |
| qp_copy_data_to_blob_data | Процедура переноса данных из столбца DATA в столбец BLOB_DATA для поля контента |
| qp_copy_parent_container | Служебная процедура копирования информации родительского контейнера при создании объекта. Не используется в QP8 |
| qp_copy_schedule_to_child_delays | Перенос расписания в дочерние статьи (по M2O-полю) |
| qp_copy_user | Клонирование пользователя |
| qp_copy_user_group | Клонирование группы пользователей |
| qp_count_child_articles | Подсчет числа статей, ссылающихся на данную |
| qp_count_duplicates | Подсчет числа дубликатов для заданного набора полей в контенте |
| qp_create_all_complex_indexes | Создает несуществующие индексы для сложных ограничений уникальности (включающих несколько полей) для всех контентов |
| qp_create_complex_index | Создает индекс для сложного ограничения уникальности (включающего несколько полей) |
| qp_create_content_index | Создает простой индекс в контенте для заданного поля |
| qp_create_content_item | Вставляет запись в таблицу CONTENT_ITEM. Не используется в QP8. |
| qp_create_deactivation_job | Создание обратного job, скрывающего статью. Используется в расписаниях показа, реализованных на SQL. |
| qp_create_indexes | Создание простых индексов для контентной таблицы (используется при пересоздании). |
| qp_create_missing_system_template | Не используется |
| qp_create_unified_fields | Создание полей виртуального UNION-контента. Неиспользуетсяв QP8. |
| qp_curtail_object_format_versions | Удаление самой старой версии для заданного OBJECT_FORMAT при превышении лимита |
| qp_date_of_schedule_to_date | Вспомогательная процедура преобразования даты и времени в формате SQL-расписания в datetime |
| qp_date_to_date_of_schedule | Вспомогательная процедура преобразования datetime в дату и время в формате SQL-расписания |
| qp_define_target_table | Определение целевой таблицы, которая должна использоваться при обновлении статьи (CONTENT_NNN или CONTENT_NNN_ASYNC) |
| qp_delete_constraint | Вспомогательная процедура удаления простого ограничения целостности для заданного поля. Используется при написании фиксов БД. |
| qp_delete_default | Вспомогательная процедура удаления значения по умолчанию для заданного поля. Используется при написании фиксов БД. |
| qp_delete_incorrect_mappings | Не используется |
| qp_delete_overflow_item_versions | Удаление самой старой версии для заданной статьи при превышении лимита |
| qp_delete_single_link | Удаляет одну запись из M2M-поля. Используется при непосредственной работе с узловой сущностью в LINQ-классах |
| qp_delete_unified_fields | Удаление полей виртуального UNION-контента. Неиспользуетсяв QP8. |
| qp_delete_workflow_notifications_and_objects | Удаление уведомлений и их объектов для заданного Workflow. Не используется в QP8 |
| qp_drop_column | Удаление столбца контентной таблицы |
| qp_drop_complex_index | Удаляет индекс для сложного ограничения уникальности (включающего несколько полей) |
| qp_drop_existing | Вспомогательная процедура удаления объекта БД. Используется при написании фиксов БД. |
| qp_drop_index | Удаляет простой индекс для заданного поля |
| qp_drop_link_view | Удаляет представления (LINK_NNN и LINK_NNN_UNITED для заданного link_id) |
| qp_drop_link_with_check | Удаляет запись из таблицы CONTENT_TO_CONTENT с проверкой, что она не используется ни одним полем |
| qp_expand | Процедура построения дерева бэкенда QP8. Также используется для вычисления пути по дереву до текущего элемента |
| qp_expand_page_trace | Процедура построения дерева трассировки страницы. Не используется в QP8 |
| qp_fill_column | Процедура заполнения колонки контентной таблицы (используется при пересоздании) |
| qp_finish_content_item_moving | Процедура коррекции данных статьи после перемещения между контентами. Не используется в QP8 |
| qp_FixTabOrder | Корректировка порядка вкладок. Не используется в QP8 |
| qp_fulltextSiteSearch | Процедура для реализации полнотекстового поиска на фронтенде. Не используется в QP8 |
| qp_get_action_by_code | Получение действия по коду |
| qp_get_action_by_id | Получениедействияпо ID |
| qp_get_action_by_type_code_and_entity_type_code | Получение действия по типу действия и типу сущности |
| qp_get_action_status_list | Получение списка допустимых действий для заданной сущности (тип, ID) |
| qp_get_action_type_by_code | Получение типа действия по коду |
| qp_get_action_type_by_id | Получение типа действия по ID |
| qp_get_action_type_code_by_action_code | Получение кода типа действия по коду действия |
| qp_get_action_views_list_by_action_code | Получение списка представлений действия по коду действия |
| qp_get_action_views_list_by_action_id | Получение списка представлений действия по ID действия |
| qp_get_article_alias | Не используется |
| qp_get_article_title | Получение заголовка статьи |
| qp_get_base_field | Получение базового поля для виртуального (с учетом статьи) |
| qp_get_breadcrumbs | Получение списка breadcrumbs для заданной сущности |
| qp_get_content_data_pivot | Не используется |
| qp_get_context_menu_by_code | Получение контекстного меню по коду |
| qp_get_context_menu_by_id | Получение контекстного меню по ID |
| qp_get_context_menu_items_list | Получение элементов контекстного меню по ID меню |
| qp_get_context_menus_list | Получениевсехконтекстныхменю |
| qp_get_default_action_code_by_entity_type_code | Получения кода действия по умолчанию по заданному коду типа сущности |
| qp_get_default_article | Получение статьи по умолчанию для заданного контента (используется при создании новой статьи) |
| qp_get_delete_item_sql | Получение SQL-запроса для удаления статьи |
| qp_get_delete_items_sql | Получение SQL-запроса для удаления списка статей одного контента |
| qp_get_entity_title | Получение заголовка сущности |
| qp_get_entity_titles_for_log | Получение списка заголовка сущностей (для аудита) |
| qp_get_entity_type_by_code | Получение типа сущности по коду |
| qp_get_entity_type_by_id | Получение типа сущности по ID |
| qp_get_field_definition | Получение типа поля в БД (используется при создании поля) |
| qp_get_folders_tree | Получение дерева папок библиотеки сайта |
| qp_get_frontend_status_weight | Получения веса для статуса статьи из таблицы CONTENT_NNN. Используется для определения того, расщеплена ли статья |
| qp_get_insert_item_sql | Получение SQL-запроса для вставки записи в таблицу CONTENT_ITEM для статьи |
| qp_get_m2o_ids | Получение значения поля типа M2O |
| qp_get_menu_status_list | Получение списка статусов элементов контекстного меню для выбранной сущности |
| qp_get_new_template_object_name | Получение имени автогенерируемого объкета для объекта типа PublishingContainer (используется только при создании сайта на шаблонах QP) |
| qp_get_paged_data | Не используется |
| qp_get_parent_entity_id | Получение ID родительскойсущности |
| qp_get_parent_entity_ids_for_tree | Получение списка ID родительских сущностей в дереве сущностей для текущего кода |
| qp_get_parent_entity_type_code_by_entity_type_code | Получение кода типа родительской сущности по коду сущности |
| qp_get_real_base_attributes | Получение списка ID всех реальных базовых полей для текущего виртуального поля |
| qp_get_recurring_parent_entity_id | Получение ID родительской сущности в дереве сущностей |
| qp_get_toolbar | Получение панели инструментов для действия |
| qp_get_toolbar_buttons_list_by_action_code | Получение списка кнопок на панели инструментов по коду действия |
| qp_get_translations | Получение списка переводов для фразы |
| qp_get_update_cell_sql | Получение SQL-запроса для обновления поля статьи |
| qp_get_update_column_sql | Получение SQL-запроса для обновления столбца контентной таблицы |
| qp_get_update_field_sql | Получение SQL-запроса для обновления столбца контентной таблицы (используется при пересоздании контентной таблицы) |
| qp_get_update_flags_sql | Получение SQL-запроса для обновления флагов статьи |
| qp_get_update_item_sql | Получение SQL-запроса для обновления записи в таблице CONTENT_ITEM статьи |
| qp_get_update_items_flags_sql | Получение SQL-запроса для обновления флагов списка статей |
| qp_get_upsert_items_sql | Получение SQL-запроса для вставки/обновления записей в таблице CONTENT_ITEM для списка статей |
| qp_get_versions | Получение версионных данных для статьи |
| qp_get_view_type_by_id | Получение типа представления по ID |
| qp_get_workflow_max_status_weight | Получение максимального статуса Workflow |
| qp_GetActionPermissionAsQuery | Вспомогательная процедура, использующаяся для вычисления прав доступа при отображении списка действий. |
| qp_GetContentData | Процедура постраничного получения статей из контента (ранее использовалась как основная в API, оставлена для обратной совместимости) |
| qp_GetContentPage | Универсальная процедура постраничного вывода (старая версия) (не используется в QP8, оставлена для обратной совместимости) |
| qp_GetContentPageFullText | Процедура постраничного вывода статей с полнотекстовым поиском (не используется в QP8, оставлена для обратной совместимости) |
| qp_GetContentPageNew | Универсальная процедура постраничного вывода (новая версия) (не используется в QP8, оставлена для обратной совместимости) |
| qp_GetEntityPermissionAsQuery | Вспомогательная процедура, использующаяся для вычисления прав доступа при отображении списка сущностей. |
| qp_getNodeFullPath | Процедура вычисления пути по иерархии для статей. Не используется в QP8 |
| qp_GetPermittedItemsAsQuery | Вспомогательная процедура, использующаяся для вычисления прав доступа при отображении любых списков. |
| qp_GetUsersByItemID_And_Permission | Вспомогательная процедура Security. Не используется в QP8 |
| qp_GetVersionsForItem | Не используется |
| qp_getVirtualAttributesTree | Построение дерева JOIN-контента. Не используется в QP8 |
| qp_insert_content_item | Процедура вставки записи в таблицу CONTENT_ITEM. Не используется в QP8 |
| qp_insert_m2m_field_Values | Множественная вставка/обновление значений M2M по XML |
| qp_insert_single_link | Вставляет одну запись в M2M-поле. Используется при непосредственной работе с узловой сущностью в LINQ-классах. |
| qp_insertArticleValues | Множественное обновление данных статей по XML |
| qp_is_entity_exists | Проверка на существование заданной сущности |
| qp_is_target_table_async | Проверка на то, что при обновлении статьи ее текущую версию надо записывать в таблицу CONTENT_NNN_ASYNC вместо CONTENT_NNN |
| qp_item_exists | Вспомогательная процедура проверки на существование записи в контентной таблице |
| qp_lastArticles | Список последних редактировавшихся статей. Не используется в QP8 |
| qp_lastNotifications | Список последних отправленных уведомлений. Не используется в QP8 |
| qp_lastObjects | Список последних редактировавшихся объектов. Не используется в QP8 |
| qp_lastPages | Список последних редактировавшихся страниц. Не используется в QP8 |
| qp_latestApproval | Список последних утвержденных статей. Не используется в QP8 |
| qp_lock | Процедура блокировки/разблокировки статьи пользователем |
| qp_merge_article | Служебная процедура слияния опубликованной и служебной версии статьи. Используется при обновлении статей |
| qp_merge_links | Служебная процедура слияния опубликованных и служебных версий полей M2M для статьи. Используется при обновлении статей |
| qp_mostUpdated | Список наиболее часто обновлявшихся контентов. Не используется в QP8 |
| qp_real_content_list | Получение списка реальных (не виртуальных) контентов с учетом Security для использования в дереве бэкенда |
| qp_rebuild_all_link_views | Пересобирает представления LINK_NN, LINK_NN_UNITED |
| qp_rebuild_content | Пересоздание контентной таблицы |
| qp_RebuildFullText | Делает полную пересборку полнотекстового индекса |
| qp_recreate_all_content_tables | Процедура пересоздания всех контентных таблиц для всех сайтов. Не используется |
| qp_recreate_column | Пересоздание колонки контентной таблицы. Используется при таком изменении типа поля, когда меняется тип в БД (например NUMERIC –\> NVARCHAR) |
| qp_recreate_content_tables | Процедура пересоздания всех контентных таблиц для данного сайта. Не используется |
| qp_rename_column | Процедура переименования колонки контентной таблицы при изменении имени поля |
| qp_rename_iterative_entities | Не используется |
| qp_replicate | Полная процедура переноса данных одной статьи из CONTENT_DATA и CONTENT_ITEM в CONTENT_NNN и CONTENT_NNN_ASYNC. Также обновляет CONTENT_MODIFICATION. |
| qp_replicate_items | Полная процедура переноса данных списка статей из CONTENT_DATA и CONTENT_ITEM в CONTENT_NNN и CONTENT_NNN_ASYNC. Также обновляет CONTENT_MODIFICATION. |
| qp_save_object | Процедура создания нового объекта. Не используется в QP8 |
| qp_setup_content_item_data | Вспомогательная процедура для переноса статей между контентами. Не используется в QP8 |
| qp_site_folder_list | Процедура получения списка папок библиотеки сайта с учетом Security |
| qp_sites_list | Процедура получения списка папок библиотеки сайта с учетом Security |
| qp_tstr | Вспомогательная процедура шаблонизации строк. Неиспользуетсяв QP8 |
| qp_update_acrticle_modification_date | Обновляет дату модификации статей по XML. Используется при импорте |
| qp_update_blob_data | Процедура обновления поля BLOB_DATA в таблице CONTENT_DATA. Используется при одиночном обновлении статьи |
| qp_update_data | Процедура обновления поля DATA в таблице CONTENT_DATA. Используется при одиночном обновлении статьи |
| qp_update_items_with_content_data_pivot | Процедура массового переноса данных статей из CONTENT_DATA в CONTENT_NNN и CONTENT_NNN_ASYNC. Используется при импорте. |
| qp_update_m2m | Обновление заданного значения M2M |
| qp_update_m2m_values | Массовое обновление M2M по XML. |
| qp_update_m2o | Предварительное обновление заданного значения M2O |
| qp_update_m2o_final | Финальное обновление всех значений M2O для статьи |
| qp_update_o2mfieldvalues | Массовое обновление O2M по XML |
| qp_update_translations | Добавление/обновление перевода для ресурса, хранящегося в БД |
| qp_update_with_content_data_pivot | Обновление контентной таблицы для заданной статьи одним SQL-запросом (с помощью PIVOT) |
| qp_versions | Возвращает список версий БД (выполненных фиксов) |
| qp_virtual_content_list | Возвращает список виртуальных контентов для пользователя с учетом Security для использования в дереве бэкенда |
| qp_workflow_list | Возвращает список Workflow для пользователя с учетом Security для использования в дереве бэкенда |
| qp_wrapper_curtail_object_format_versions | Вспомогательная функция (оставлена для обратной совместимости) |
| restore_content_item_version | Восстанавливает версию статьи |
| restore_object_format_version | Восстанавливает версию формата |
| usp_fts_parser | Поиск словоформ заданного слова (используется подсветкой полнотекстового поиска) |
