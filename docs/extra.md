
# Дополнительные таблицы и поля для работы с контентами

## Таблица ATTRIBUTE_TYPE


Справочная таблица, описывающие возможные типы полей контента (подтипы определяются не здесь, а в коде)


#### ATTRIBUTE_TYPE_ID

Уникальный идентификатор типа поля. Эти значения активно используются в коде как константы.

#### TYPE_NAME

Имятипаполя

#### DESCRIPTION

Описание типа поля

#### TYPE_IMAGE

Иконка типа поля. Не используется в QP8

#### DATABASE_TYPE

Тип генерируемого столбца в БД

#### INPUT_TYPE

Контрол ввода. Не используется в QP8

#### CHECK_FUNCTION

Проверка на доступность типа. Не используется в QP8

#### ICON

Иконка типа (в QP8)

## Таблица CONTENT_CONSTRAINT


Задает ограничения уникальности, определенные для полей контента


#### constraint_id

Уникальный идентификатор ограничения

#### content_id

ID контента, на котором определяется ограничение([Таблица CONTENT](#таблица-content))

### Триггеры

#### td_content_indexes

Срабатывает после удаления ограничения. Удаляет соответствующие индексы

#### tu_content_indexes

Срабатывает после обновления ограничения. Удаляет соответствующие индексы

## Таблица CONTENT_CONSTRAINT_RULE


Хранит информацию о полях, принимающих участие в ограничении уникальности


#### constraint_id

Идентификатор ограничения уникальности (Таблица CONTENT_CONSTRAINT)

#### attribute_id

Идентификатор поля ([Таблица CONTENT_ATTRIBUTE](#таблица-content_attribute))

## Таблица CONTENT_FOLDER


Хранит информацию о папках библиотеки контента


#### content_ID

Идентификаторсайта ([Таблица CONTENT](#таблица-content))

#### FOLDER_ID

Идентификатор папки. Генерируется автоматически

#### PARENT_FOLDER_ID

Идентификатор родительской папки

#### NAME

Имя папки

#### DESCRIPTION

Описание папки

#### FILTER

Не используется

#### PATH

Относительный путь к папке от корня библиотеки (заполняется автоматически триггером)

#### CREATED

Дата создания папки. Генерируется автоматически

#### MODIFIED­

Дата последнего изменения папки. Генерируется и изменяется автоматически.

#### LAST_MODIFIED_BY

ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего свойства папки

### Триггеры

#### tiu_content_folder_path

Срабатывает после создания или обновления свойств папки. Обновляет свойство PATH.

## Таблица FOLDER


Хранит информацию о папках библиотеки сайта


#### SITE_ID

Идентификатор сайта ([Таблица SITE](#таблица-site))

#### FOLDER_ID

Идентификатор папки. Генерируется автоматически

#### PARENT_FOLDER_ID

Идентификатор родительской папки

#### NAME

Имя папки

#### DESCRIPTION

Описание папки

#### FILTER

Не используется

#### PATH

Относительный путь к папке от корня библиотеки (заполняется автоматически триггером)

#### CREATED

Дата создания папки. Генерируется автоматически

#### MODIFIED­

Дата последнего изменения папки. Генерируется и изменяется автоматически.

#### LAST_MODIFIED_BY

ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего свойства папки

### Триггеры

#### tiu _folder_path

Срабатывает после создания или обновления свойств папки. Обновляет свойство PATH.

## Таблица CONTENT_GROUP


Хранит информацию о группах контентов


#### content_group_id

Идентификатор группы контентов. Генерируется автоматически

#### site_id

Идентификатор сайта ([Таблица SITE](#таблица-site))

#### name

Имя группы контентов

## Таблица CONTENT_ITEM_SCHEDULE


Хранит информацию о расписании статей


#### CONTENT_ITEM_ID

Идентификатор статьи, к которой применяется расписание ([Таблица CONTENT_ITEM](#таблица-content_item))

#### SCHEDULE_ID

Идентификатор расписания. Генерируется автоматически

#### MAXIMUM_OCCURENCES

Не используется

#### CREATED

Дата создания расписания. Генерируется автоматически

#### MODIFIED­

Дата последнего изменения расписания. Генерируется и изменяется автоматически.

#### LAST_MODIFIED_BY

ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего свойства расписания

#### freq_type

Одноименный параметр инициализации хранимой процедуры sp_add_jobschedule

#### freq_interval

Одноименный параметр инициализации хранимой процедуры sp_add_jobschedule

#### freq_subday_type

Одноименный параметр инициализации хранимой процедуры sp_add_jobschedule

#### freq_subday_interval

Одноименный параметр инициализации хранимой процедуры sp_add_jobschedule

#### freq_relative_interval

Одноименный параметр инициализации хранимой процедуры sp_add_jobschedule

#### freq_recurrence_factor

Одноименный параметр инициализации хранимой процедуры sp_add_jobschedule

#### active_start_date

Одноименный параметр инициализации хранимой процедуры sp_add_jobschedule

#### active_end_date

Одноименный параметр инициализации хранимой процедуры sp_add_jobschedule

#### active_start_time

Одноименный параметр инициализации хранимой процедуры sp_add_jobschedule

#### active_end_time

Одноименный параметр инициализации хранимой процедуры sp_add_jobschedule

#### Occurences

Не используется

#### use_duration

Флаг, позволяющий указывать продолжительность задачи, а не дату окончания.

#### Duration

Продолжительность задачи

#### duration_units

Единицы измерения, для продолжительности задачи

#### DEACTIVATE

Флаг, позволяющий отключить расписание без его удаления

#### DELETE_JOB

Вспомогательный флаг, указывающий на то, что запись должна быть удалена, когда она перестанет использоваться

#### USE_SERVICE

Флаг, указывающий, создавать JOB или нет. Если USE_SERVICE = 1, JOB не создается, расписание статей при этом должно реализовываться внешним сервисом.

### Триггеры

#### td_content_item_schedule_del_job

Вызывается после удаления записи о расписании. Удаляетсоответствующий Job.

#### ti_content_item_schedule_add_job

Вызывается после добавления записи о расписании. Создает соответствующий Job.

## Таблица CONTENT_ITEM_VERSION


Хранит информацию о версиях статей. Создание версии выполняется хранимой процедурой create_content_item_version (Процедура create_content_item_version)


#### CONTENT_ITEM_VERSION_ID

Уникальный идентификатор версии. Генерируется автоматически.

#### VERSION

В настоящее время не используется. Оставлено для обратной совместимости с QP7

#### VERSION_LABEL

В настоящее время не используется. Оставлено для обратной совместимости с QP7

#### CONTENT_VERSION_ID

Неиспользуется

#### CONTENT_ITEM_ID

Идентификатор статьи, для которой создается версия ([Таблица CONTENT_ITEM](#таблица-content_item))

#### DESCRIPTION

Описание версии

#### CREATED

Дата создания версии

#### CREATED_BY

ID пользователя ([Таблица USERS](#таблица-users)), создавшего версию

#### MODIFIED

Дата последней модификации данных, которые содержит версия

#### LAST_MODIFIED_BY

ID пользователя ([Таблица USERS](#таблица-users)), который последним модифицировал данные, содержащиеся в версии

### Триггеры

#### tbd_content_item_version

Вызывается перед удалением версии. Выполняет необходимое каскадное удаление.

## Таблица VERSION_CONTENT_DATA


Хранит данные для версий статей, а именно копию данных из CONTENT_DATA ([Таблица CONTENT_DATA](#таблица-content_data)).


#### ATTRIBUTE_ID

Идентификатор поля ([Таблица CONTENT_ATTRIBUTE](#таблица-content_attribute)), для которого сохраняется версионная информация

#### CONTENT_ITEM_VERSION_ID

Идентификатор сохраняемой версии ([Таблица CONTENT_ITEM_VERSION](#таблица-content_item_version))

#### DATA

Копия поля DATA из таблицы CONTENT_DATA

#### BLOB_DATA

Копия поля BLOB_DATA из таблицы CONTENT_DATA

#### CREATED

Дата сохранения версионной информации

## Таблица ITEM_TO_ITEM_VERSION


Хранит данные полей M2M для версий статей


#### content_item_version_id

Идентификатор сохраняемой версии ([Таблица CONTENT_ITEM_VERSION](#таблица-content_item_version))

#### attribute_id

Идентификатор поля M2M ([Таблица CONTENT_ATTRIBUTE](#таблица-content_attribute)), для которого сохраняется версионная информация

#### linked_item_id

Идентификатор связанной статьи ([Таблица CONTENT_ITEM](#таблица-content_item))

## Таблица CONTENT_MODIFICATION


Хранит данные о последних модификациях контентных таблиц. Заполняется автоматически. Используется клиентским кодом для организации поллинга и сброса кэша.


#### CONTENT_ID

Идентификатор контента ([Таблица CONTENT](#таблица-content))

#### LIVE_MODIFIED

Последняя дата модификации данных для Live-сайта

#### STAGE_MODIFIED

Последняя дата модификации данных для Stage-сайта

## Таблица CONTENT_WORKFLOW_BIND


Хранит привязку контентов к Workflow


#### CONTENT_ID

Идентификатор контента ([Таблица CONTENT](#таблица-content))

#### WORKFLOW_ID

Идентфикатор Workflow ([Таблица WORKFLOW](#таблица-workflow))

#### is_async

Признак того, что статьи могут расщепляться

## Таблица ARTICLE_WORKFLOW_BIND


Хранит привязку статей к Workflow


#### CONTENT_ITEM_ID

Идентификатор статьи ([Таблица CONTENT_ITEM](#таблица-content_item))

#### WORKFLOW_ID

Идентфикатор Workflow ([Таблица WORKFLOW](#таблица-workflow))

#### is_async

Признак того, что статья может расщепляться

## Таблица FIELD_ARTICLE_BIND


Хранит значения по умолчанию для полей M2M. Для других типов полей значения по умолчанию хранятся непосредственно в таблице CONTENT_ATTRIBUTE (DEFAULT_BLOB_VALUE, DEFAULT_VALUE)


#### ARTICLE_ID

Идентификатор статьи ([Таблица CONTENT_ITEM](#таблица-content_item))

#### FIELD_ID

Идентификатор поля ([Таблица CONTENT_ATTRIBUTE](#таблица-content_attribute))

## Таблица NOTIFICATIONS


Хранит настройки уведомлений


#### NOTIFICATION_ID

Уникальный идентификатор уведомления. Генерируется автоматически.

#### NOTIFICATION_NAME

Уникальное в пределах контента имя уведомления

#### CONTENT_ID

Идентификатор родительского контента (CONTENT_ID)

#### FORMAT_ID

Идентификатор формата ([Таблица OBJECT_FORMAT](#таблица-object_format)) для генерации тела письма. Не используется в актуальной версии

#### USER_ID

Идентификатор пользователя ([Таблица USERS](#таблица-users)), которому будет послано уведомление

#### GROUP_ID

Идентификатор группы пользователя ([Таблица USER_GROUP](#таблица-user_group)), которой будет послано уведомление

#### FOR_CREATE

Флаг, указывающий, что уведомление будет послано при создании новой статьи

#### FOR_MODIFY

Флаг, указывающий, что уведомление будет послано при обновлении существующей статьи

#### FOR_REMOVE

Флаг, указывающий, что уведомление будет послано при удалении существующей статьи

#### CREATED

Дата создания версии

#### MODIFIED

Дата последней модификации данных, которые содержит версия

#### LAST_MODIFIED_BY

Идентификатор пользователя ([Таблица USERS](#таблица-users)), который последним модифицировал данные, содержащиеся в версии

#### for_status_changed

Флаг, указывающий, что уведомление будет послано при изменении статуса существующей статьи

#### for_frontend

Флаг, указывающий, что уведомление будет послано только при программном вызове

#### notify_on_status_type_id

Идентификатор статуса на который должно быть послано уведомление (при установленном флаге for_status_changed) ([Таблица STATUS_TYPE](#таблица-status_type))

#### email_attribute_id

Идентификатор поля текущего контента, содержащее e-mail, на который будет послано уведомление ([Таблица CONTENT_ATTRIBUTE](#таблица-content_attribute))

#### no_email

Флаг, указывающий, что e-mail посылать не нужно. Уведомление является просто триггером для вызова некоторого кода.

#### send_files

Флаг, определяющий посылать ли поля типа файла как вложения

#### workflow_id

Идентификатор Workflow ([Таблица WORKFLOW](#таблица-workflow)). Если он установлен, уведомление было создано автоматически для Worfklow.

#### from_backenduser_id

Идентификатор пользователя ([Таблица USERS](#таблица-users)), который будет указан в письме как отправитель

#### from_backenduser

Флаг, указывающий, что для идентификации отправителя будет использовано поле from_backenduser_id

#### from_default_name

Флаг, указывающий, что в качестве отправителя будет использован пользователь бэкенда по умолчанию.

#### from_user_email

Текстовое поле, явно указывающее e-mail отправителя

#### from_user_name

Текстовое поле, явно указывающее имя отправителя

#### for_status_partially_changed

Флаг, указывающий, что уведомление будет послано при частичном изменении статуса существующей статьи (ParallelWorkflow)

#### USE_QA_MAIL

Используется только в QP7 для ASP-сайтов. Указывает на то, что при отправке уведомлений по почте надо использовать компонент QA_Mail (отсутствует в новых поставках)

#### IS_EXTERNAL

Флаг, указывающий, что уведомление является внешним.

#### EXTERNAL_URL

Внешний URL (для внешнего уведомления)

#### FOR_DELAYED_PUBLICATION

Флаг, указывающий, что уведомление будет послано при отложенной публикации

#### USE_SERVICE

Внешнее уведомление должно быть обработано асинхронно (с использованием сервиса)

#### TEMPLATE_ID

ID статьи, содержащей Liquid-шаблон уведомления

#### HIDE_RECIPIENTS

Скрывать получателей уведомления друг от друга.
#### USE_EMAIL_FROM_CONTENT

Загружать e-mail получателей из отдельного контента (для функциональности рассылок).
#### CATEGORY_ATTRIBUTE_ID

ID поля категории (для функциональности рассылок).

#### CONFIRMATION_TEMPLATE_ID

ID статьи, содержащей Liquid-шаблон подтверждения подписок (для функциональности рассылок).

## Таблица EXTERNAL_NOTIFICATION_QUEUE


Таблица, реализующая очередь уведомлений для отправки внешним сервисом


#### ID

Идентификатор записи в очереди. Генерируется автоматически

#### EVENT_NAME

Код типа уведомления

#### ARTICLE_ID

Идентификатор статьи, для которой отправляется уведомление

#### CREATED

Дата создания записи

#### URL

Внешний URL

#### TRIES

Количество неудачных попыток отправки

#### NEW_XML

XML новой версии статьи (после события)

#### OLD_XML

XML старой версии статьи (до события)

#### SENT

Успешно ли отправлено уведомление?

## Таблица NOTIFICATIONS_SENT


Таблица, хранящая информацию об отправках уведомлений пользователям бэкенда


#### ID

Идентификатор отправки
#### user_id

Идентификатор пользователя, которому было послано уведомление ([Таблица USERS](#таблица-users))

#### notification_id

Идентификатор уведомления (Таблица NOTIFICATIONS)

#### content_item_id

Идентификатор статьи, для которой было послано уведомления ([Таблица CONTENT_ITEM](#таблица-content_item))

#### sent

Дата посылки

#### event_txt

Код события, для которого сработало уведомление

## Таблица SYSTEM_NOTIFICATIONS_QUEUE

Очередь отправки системных сообщений CDC.


#### ID

ID системного сообщения

#### CdcLastExecutedLsnId

Ссылка на статус синхронизации  

#### TRANSACTION_LSN

ID транзакции

#### TRANSACTION_DATE

Дата транзакции

#### URL

URL синхронизации

#### TRIES

Количество неудачных попыток отправки

#### JSON

Тело сообщения

#### SENT

Сообщение отправлено?
#### CREATED

Дата создания сообщения
#### MODIFIED

Дата изменения сообщения


## Таблица CHILD_DELAYS


Хранит информацию об отложенной публикации дочерних статей (используется совместно с полями связи типа M2O)


#### Id

Идентификатор родитльской статьи (контент содержит поле M2O) ([Таблица CONTENT_ITEM](#таблица-content_item))

#### child_id

Идентификатор дочерней статьи (контент содержит поле O2M) ([Таблица CONTENT_ITEM](#таблица-content_item))

## Таблица DYNAMIC_IMAGE_ATTRIBUTE


Таблица-расширение для таблицы CONTENT_ATTRIBUTE. Хранит специфическую информацию для полей типа Динамическое изображение.


#### ATTRIBUTE_ID

Идентификатор поля ([Таблица CONTENT_ATTRIBUTE](#таблица-content_attribute))

#### WIDTH

Ограничение ширины динамического изображения

#### HEIGHT

Ограничение высоты динамического изображения

#### TYPE

Расширение генерируемого файла

#### QUALITY

Качество сжатия JPG

#### MAX_SIZE

Флаг, указывающий, что изображение должно быть вписано в прямоугольник WIDTHxHEIGHT (должны быть заданы оба) с сохранением пропорций

## Таблица MASK_TEMPLATE


Хранит стандартные маски (регулярные выражения) для проверки полей типа Строка. При выборе маски значение поля MASK копируется в поле FORMAT_MASK.


#### ID

Идентификатор маски

#### MASK

Регулярное выражение

#### NAME

Отображаемый заголовок

## Таблица UNION_ATTRS


Хранит привязку полей виртуального контента типа UNION к полям базового контента(контентов), на которых они построены


#### virtual_attr_id

Идентификатор поля в виртуальном контенте типа UNION ([Таблица CONTENT_ATTRIBUTE](#таблица-content_attribute))

#### union_attr_id

Идентификатор базового поля в исходном контенте ([Таблица CONTENT_ATTRIBUTE](#таблица-content_attribute))

#### EF_FIX

Служебное поле, используется для создания корректной модели EF

## Таблица UNION_CONTENTS


Хранит привязку виртуального контента типа UNION к базовым контентам, на которых он построены


#### virtual_content_id

Идентификатор виртуального контента типа UNION ([Таблица CONTENT](#таблица-content))

#### union_content_id

Идентификатор базового контента ([Таблица CONTENT](#таблица-content))

#### master_content_id

Идентификатор мастер-контента ([Таблица CONTENT](#таблица-content)). Не используется в QP8, оставлено для обратной совместимости с QP7

### Триггеры

#### ti_union_contents_auto_map_attrs

Выполняется после вставки новых записей. Осуществляет автоматическое заполнение таблицы UNION_ATTRS.

## Таблица USER_QUERY_ATTRS


Хранит привязку виртуального контента типа USERQUERY к используемым базовым полям.


#### virtual_content_id

Идентификатор виртуального контента типа USERQUERY ([Таблица CONTENT](#таблица-content))

#### user_query_attr_id

Идентификатор базового поля в исходном контенте ([Таблица CONTENT_ATTRIBUTE](#таблица-content_attribute))

## Таблица USER_QUERY_CONTENTS


Хранит привязку виртуального контента типа USERQUERY к используемым базовым контентам.


#### virtual_content_id

Идентификатор виртуального контента типа USERQUERY ([Таблица CONTENT](#таблица-content))

#### real_content_id

Идентификатор базового контента ([Таблица CONTENT](#таблица-content))

#### is_id_source

В настоящее время не используется

## Таблица WAITING_FOR_APPROVAL


Хранит информацию о частичном утверждении статей при параллельном Workflow


#### CONTENT_ITEM_ID

Идентификатор частично утвержденной статьи ([Таблица CONTENT_ITEM](#таблица-content_item))

#### USER_ID

Идентификатор пользователя, который утвердил статью ([Таблица USERS](#таблица-users))

#### STATUS_TYPE_ID

ID статуса статьи по Workflow ([Таблица STATUS_TYPE](#таблица-status_type)).

## Таблица WORKFLOW


Хранит настройки Workflow


#### WORKFLOW_ID

Идентификатор Workflow. Генерируется автоматически

#### WORKFLOW_NAME

Уникальное в пределах сайта имя Workflow

#### DESCRIPTION

Описание

#### CREATED

Дата создания Workflow. Генерируется автоматически

#### MODIFIED­

Дата последнего изменения Workflow. Генерируется и изменяется автоматически.

#### LAST_MODIFIED_BY

ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего свойства Workflow

#### SITE_ID

ID родительского сайта ([Таблица SITE](#таблица-site))

#### create_default_notification

Флаг, указывающий на то, что для Workflow должны быть созданы уведомления по умолчанию. Такие уведомления будут ссылаться на текущий Workflow через поле workflow_id

#### apply_by_default

Флаг, указывающий на применение по умолчанию. Неиспользуетсяв QP8.

### Триггеры

#### td_content_and_article_workflow_bind

Выполняется после удаления Workflow. Удаляет привязки к контентам и статьям.

#### ti_access_workflow

Выполняется после создания Workflow. Добавляет права доступа по умолчанию на Workflow.

## Таблица WORKFLOW_RULES


Содержит этапы Workflow


#### WORKFLOW_RULE_ID

Идентификатор этапа Workflow

#### USER_ID

Идентификатор пользователя, назначенного на этап Workflow ([Таблица USERS](#таблица-users))

#### GROUP_ID

Идентификатор группы пользователей, назначенной на этап Workflow ([Таблица USER_GROUP](#таблица-user_group))

#### RULE_ORDER

Числовое поле, определяющее порядок правил

#### PREDECESSOR_PERMISSION_ID

Не используется. Оставлено для совместимости с кодом QP7.

#### SUCCESSOR_PERMISSION_ID

Не используется. Оставлено для совместимости с кодом QP7.

#### SUCCESSOR_STATUS_ID

ID статуса статьи, относящегося к этапу Workflow ([Таблица STATUS_TYPE](#таблица-status_type)).

#### COMMENT

Комментарий

#### WORKFLOW_ID

Идентификатор родительского Workflow ([Таблица WORKFLOW](#таблица-workflow))

## Таблица STATUS_TYPE


Хранит информацию о возможных статусах статей


#### SITE_ID

Идентификатор родительского сайта ([Таблица SITE](#таблица-site))

#### STATUS_TYPE_ID

Идентификатор статуса. Генерируется автоматически

#### STATUS_TYPE_NAME

Имя статуса. Уникально в пределах сайта

#### WEIGHT

Вес статуса

#### DESCRIPTION

Описание

#### CREATED

Дата создания статуса. Генерируется автоматически

#### MODIFIED­

Дата последнего изменения статуса. Генерируется и изменяется автоматически.

#### LAST_MODIFIED_BY

ID последнего пользователя ([Таблица USERS](#таблица-users)), менявшего свойства статуса

#### BUILT_IN

Флаг, указывающй на то, что статус является встроенным (его невозможно изменить или удалить)

#### COLOR

Основной цвет подсветки статусов

#### ALT_COLOR

Дополнительный цвет подсветки статусов