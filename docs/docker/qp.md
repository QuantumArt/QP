# Докер-образ QP8.CMS

## Назначение

Образ содержит основное приложение **QP8.CMS c поддержкой PostgreSQL**. Использование образа описано в [руководстве администратора QP8.CMS c поддержкой PostgreSQL](https://storage.qp.qsupport.ru/qa_official_site/images/downloads/qp8-pg-admin-man.pdf) (в разделе **Установка на Linux**).

## Репозитории

* [DockerHub](https://hub.docker.com/r/qpcms/qp/tags): `qpcms/qp`
* QA Harbor: `registry.quantumart.ru/qp8-cms/qp`

## История версий

### Актуальная версия

### 8.6.4.0

* Добавлена интеграция с KeyCloak и SSO на базе KeyCloak (#178011)
* Исправлена ошибка всплывающего окна авторизации после авторизации по прямой ссылке
* Добавлена возможность удаления агрегированной статьи в случае, если в агрегированном поле нет значения (#178136)
* Исправлена ошибка и проблема производительности для расщепленных статей (#178013)
* Исправлена ошибка в названиях столбцов виртуальных контентов типа "USER QUERY" (#177871)
* Убрано окно предупреждения о несохранённых изменениях в пользовательском действии внешнего workflow (camunda) после успешного выполнения действия (#177972)
* Исправлена ошибка в списке задач пользователя (camunda) (#177969)
* Добавлена поддержка внешнего workflow (camunda) (#170622)
* Исправлена ошибка проверки прав доступа связанных сущностей (#177834)
* Исправлена ошибка создания версий файлов контента при наличии полей с одинаковыми файлами (#177624)

### 8.6.3.0

* Исправлена ошибка копирования/вставки значений полей связи между разными статьями (#177661)
* Добавлена поддержка записи/воспроизведения для прав доступа на действия (#177216)
* Исправлена ошибка при удаления расписания публикации в PG (#177578)

### 8.6.2.0

* Исправлена ошибка отображения значения по умолчанию для полей, чей тип изменен на "Визуальный редактор" (Visual Editor) (#176843)
* Исправлена ошибка применения пользовательских M2M-фильтров для 2 элементов (#176437)
* Обновлены nuget-пакеты `Npgsql`, `SixLabors.ImageSharp` и `Microsoft.Extensions.Caching.Memory` через транзитивные зависимости в связи с найденными уязвимостями (#176358)

### 8.6.1.0

* Исправлена NRE-ошибка переименования файла при отключенном S3 (#176335)
* Исправлена ошибка работы с полями логического типа в Postgres при создании виртуального контента (#175689)
* Добавлен запрет вставки JS и Expression в html-атрибуты в html-тексте текстовых полей (#175724)
* Исправлена ошибка расщепления статей (#175287)
* Добавлен отключаемый запрет на сохранение [атрибутов событий](https://www.w3schools.com/tags/ref_eventattributes.asp) в html-тегах в текстовых полях
* Увеличена ширина выпадающего списка в toolbar-е
* Обновлена библиотека QA.Validation.Xaml.Extensions до 1.4.3 (#175116):
  * Добавлено условие валидации IsEven 
  * Поправлена работа условий валидации GreaterThan и LessThan

### 8.6.0.0

* Добавлена поддержка MinIO (#174303)
* Обновлена библиотека Quantumart.AspNetCore до 6.1.0
* Добавлено создание версий файлов при импорте из CSV (#174736)
* Добавлена запись в лог аудита при импорте из CSV (#174737)
* Исправлена запись в лог аудита загрузки файла (#174738)
* Исправлено имя файла аттачмента в уведомлениях (#174700)
* Добавлена поддержка режимов **Use Site Library** и **Subfolder** для имен файлов аттачментов в уведомлениях (#174699)
* Исправлена ошибка при выборе пользователя в уведомлении (#174698)
* Добавлено скрытие опции "Собрать" (Assemble) в контекстном меню сайта и в контекстном меню уведомлений при установленной галочке "Внешняя разработка" (External Development) (#174938)
* Убрана генерация нового GUID для поля UniqueId при воспроизведении действия создания новой статьи при отключённой галочке "Использовать замену GUID" (Use GUID Substitution) (#174657)
* В свойствах сайта добавлено скрытие поля "Режим работы сайта" (Site Mode) при установленной галочке "Внешняя разработка" (External Development) (#174658)
* Исправлена инициализация значения по умолчанию для визуального редактора (#174655)
* Добавлены дополнительные опции для выполнения Custom Action (#174495)
* В журнал аудита действий добавлена информация о ролях пользователя на момент выполнения запроса и IP пользователя с которого выполнялся запрос (#174544)
* Исправлена передача в TimePicker правильного формата времени в русской локализации (#174512)
* В логи добавлена ифнормация о id пользователя, имени пользователя, IP пользователя и id ролей пользователя. Обновлены библиотеки NLog (#174504)
* Добавлено обновление таблицы content_modification после отработки запланированной смены видимости (#174390)
* Исправлена ошибка UI при открытии на редактировнаие статьи в поле Title которой есть закрывающий тег script
* Изменена логика закрытия лога сессии пользователя в БД, ранее при входе и выходе закрывались все сессии, теперь закрывается конкретная сессия (#174384)
* Добавлена серверная валидация html-тегов сохраняемых в текстовые поля, настройки разрешенных тегов и доменов для тегов ссылающихся на сторонние ресурсы (#174182)
* Обновлена библиотека SixLabors.ImageSharp до 3.1.3 через Quantumart.AspNetCore (#174238)

### 8.5.3.0

* Исправлена фильтрация по булевым полям в PostgreSQL
* Исправлена загрузка контентов в редакторе Custom Action (#173095)
* Исправлено потенциальная очистка полей связи (при 500 ошибке на сервере)
* Выполнена оптимизация работы с Relation Security #174007
* Выполнена оптимизация запросов к контентым таблицам через добавление поддержки нативных типов EF (#173019)

### 8.5.2.0

* Добавлена опция AllowReplayWithRecording для разрешения одновременного воспроизведения и записи действий (#173910)
* Запрещено задание XAML-валидации для нового контента (#173941)
* Добавлена опция UseClientExceptions для управления выводом исключений в браузер (#173940)
* Добавлено чтение appsettings.json и env для ConsoleDbUpdate
* Обновлена библиотека SqlClient до 4.8.6
* Исправлена проверка значений при преобразовании числа в O2M (#173911)
* Добавлена поддержка замены ID при воспроизведении действий (#173909):
  * ID полей в XAML-валидаторе контента
  * ID контента-расширения в ItemDefinition (для QP8.WidgetPlatform)
* Исправлена ошибка LDAP при попытке авторизации пользователя, которого нет в AD, при выключенном переходе по связям в AD
* Исправлена ошибка автоматического сопоставления полей Extension-ов в механизме импорта статей, экспортированных из QP, при работе с PostgreSQL
* Добавлена настройка для постоянного хранения ключей защиты сессий во внешнем хранилище

### 8.5.1.0

* Обновлёна зависимость System.Security.Cryptography.X509Certificates (#173523)
* Выполнен рефакторинг моделей в соответствии с замечаниями аудита
* Исправлена проверка имени папки на пустое значение
* Изменена автозамена плейсхолдеров upload_url в интерфейсе QP на полные абсолютные ссылки без протокола (#173690)
* Добавлено расширенное логирование LDAP запросов (#173688)
* Изменена генерация случайных чисел с Random на RandomNumberGenerator (#173688)
* Исправлена ошибка приводящая к синхронизации из AD всех пользователей в случае, когда ни одна группа не найдена в AD
* Добавлена возможность включать и выключать обработку связей (Reference) в AD и соответствующий обработчик логики связей
* Убрана зависимость от схемы public в PostgreSQL (#173717)

### 8.5.0.0

* Исправлены права доступа по умолчанию на Customer Code (#173504)
* Добавлена проверка прав доступа на получение имени сущности для UI (#173425, #173426)
* Из собранного кода убраны лишние статические файлы для codemirror (#173391)
* Добавлена проверка прав доступа на download файла (#173373)
* Экспортируемый файл теперь создаётся во временной папке, а не на storage (#173372)
* Добавлена задача по расписанию по очистке системных папок (#173283)
* Исправлены некоторые потенциальные SQL-инъекции (#173095):
  * Запросы в Common.cs большей частью переведены на параметрические запросы (когда параметром является идентификатор или массив идентификаторов)  
  * Строковые значения в гридах переведены на параметрические запросы (Пользователи, Контенты, Поиск по коду, Аудит)
  * Параметр customFilter теперь передается в виде JSON-документа, в котором описаны применяемые фильтры
* Исправлен XSS с именем файла в библиотеке (#173382)  
* Добавлена настройка ForceHttpForImageResizing, которая принудительно включает использование http при auto-resize изображений (#173304)

### 8.4.4.0

* Закрыта xss уявзимость, связанная с необработанной выдачей пользовательского ввода (#173213)
* Добавлена поддержка webp и auto-resize изображений (#173094)

### 8.4.3.0

* Исправлена работа внутренних уведомлений с SQL Server (#173120)
* Исключены некоторые неиспользуемые элементы интерфейса (#173173)
* Исправлен поиск по M2M-статьям в режиме поиска всех статей (#173165)
* Исключены архивные статьи из интерфейса **Waiting for approval** (#173129)
* Исправлены опечатки в переводах на русский (#173130)
* Исправлена ошибка с модификацией группы **Administrators** в PostgreSQL (#173151)
* Исправлены ошибки синхронизации пользователей с AD (#173142, #173149)

### 8.4.2.0

* Исправлена работа сервиса расписания статей (PostgreSQL)

### 8.4.1.0

* Добавлена хранимая процедура `qp_change_contents_ownership` (PostgreSQL)

### 8.4.0.0

* Исправлена ошибка с периодическим сбоем секвенсов в PostgreSQL
* Добавлена функциональность внутренних уведомлений с поддержкой *Liquid*-шаблонов
* Исправлена вставка cсылки на файл из библиотеки в VE (#171970)
* Исправлена работа **VE Plugins** и **VE Styles** в PostgreSQL (#171964)
* Добавлена возможность кастомной проверки изображений при загрузке (Метод `_validateFileExternal` в файле `BackendPlUploader`)

### 8.3.0.0

* Добавлена поддержка LDAP (под Linux)
* Исправлены различные проблемы перехода на .NET 6
* Исправлен тип фильтра по полю Время в журнале аудита (#170470)
* Исправлен медленный expand M2O полей при экспорте CSV (#170572)
* Исправлены проблемы импорта CSV (#170532, #170563, #170432, #170386, #170384)
* Исправлены проблемы экспорта CSV (#170560, #170561, #170562)
* Исправлена проблема с непопаданием поля в сборку контентов (#170463)
* Увеличен в 2 раза лимит на число полей формы в QP (до 2048)
* Исправлен поиск svg-файлов в библиотеке (#170419)
* Исправлено отображение кастомных цветов для статусов (#170387)
* Исправлены ошибки создания виртуального контента в PostgreSQL (#170272)
* Исправлено удаление пользователя в PostgreSQL (#170231)

### 8.2.0.4

* Переход на .NET 6
